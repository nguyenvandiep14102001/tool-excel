<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Excel Tool</h1>
        
        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('compare-tab')">üîç So s√°nh 2 File Excel</button>
            <button class="tab-button" onclick="openTab('join-tab')">üîó Join 2 File Excel</button>
            <button class="tab-button" onclick="openTab('merge-tab')">üîÑ G·ªôp C·ªôt Excel</button>
            <button class="tab-button" onclick="openTab('split-tab')">üìä T√°ch D√≤ng Excel</button>
            <button class="tab-button" onclick="openTab('duplicate-tab')">üéØ T√¨m Tr√πng L·∫∑p</button>
        </div>

        <!-- Compare Tab -->
        <div id="compare-tab" class="tab-content active">
            <!-- File Upload Section for Compare -->
            <div class="section">
                <h2>1. T·∫£i l√™n Files Excel</h2>
                <div class="file-upload">
                    <div class="upload-group">
                        <label>File Excel 1:</label>
                        <input type="file" id="file1" accept=".xlsx,.xls">
                        <button onclick="uploadCompareFile(1)">T·∫£i l√™n</button>
                        <div id="file1-info" class="file-info"></div>
                    </div>
                    <div class="upload-group">
                        <label>File Excel 2:</label>
                        <input type="file" id="file2" accept=".xlsx,.xls">
                        <button onclick="uploadCompareFile(2)">T·∫£i l√™n</button>
                        <div id="file2-info" class="file-info"></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>2. So s√°nh Files</h2>
                <div class="feature">
                    <div class="option-group">
                        <label><input type="radio" name="compare_type" value="full_row" checked> So s√°nh to√†n b·ªô d√≤ng</label>
                        <label><input type="radio" name="compare_type" value="specific_columns"> So s√°nh theo c·ªôt c·ª• th·ªÉ</label>
                    </div>
                    
                    <div id="column-selection" class="column-selection" style="display: none;">
                        <div class="column-group">
                            <label>File 1 Column:</label>
                            <select id="col1-select"></select>
                        </div>
                        <div class="column-group">
                            <label>File 2 Column:</label>
                            <select id="col2-select"></select>
                        </div>
                    </div>
                    
                    <button onclick="compareFiles()" class="btn-primary">Th·ª±c hi·ªán So s√°nh</button>
                </div>
            </div>
        </div>

        <!-- Join Tab -->
        <div id="join-tab" class="tab-content">
            <!-- File Upload Section for Join -->
            <div class="section">
                <h2>1. T·∫£i l√™n Files Excel</h2>
                <div class="file-upload">
                    <!-- Upload File 1 -->
                    <div class="upload-group">
                        <label>File Excel 1:</label>
                        <input type="file" id="file1-join" accept=".xlsx,.xls">
                        <button onclick="uploadJoinFile(1)">T·∫£i l√™n</button>
                        <div id="file1-join-info" class="file-info"></div>
                    </div>

                    <!-- Upload File 2 -->
                    <div class="upload-group">
                        <label>File Excel 2:</label>
                        <input type="file" id="file2-join" accept=".xlsx,.xls">
                        <button onclick="uploadJoinFile(2)">T·∫£i l√™n</button>
                        <div id="file2-join-info" class="file-info"></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>2. Join Files</h2>
                <div class="feature">
                    <div class="join-instructions">
                        <p>Ch·ªçn c√°c c·ªôt t∆∞∆°ng ·ª©ng t·ª´ 2 file ƒë·ªÉ th·ª±c hi·ªán join.</p>
                    </div>
                    <button onclick="showJoinColumnSelection()" class="btn-primary">
                        Ch·ªçn C·ªôt v√† Th·ª±c hi·ªán Join
                    </button>
                </div>
            </div>
        </div>

        <!-- Merge Columns Tab -->
        <div id="merge-tab" class="tab-content">
            <div class="section">
                <h2>1. T·∫£i l√™n File Excel ƒë·ªÉ G·ªôp C·ªôt</h2>
                <div class="feature">
                    <div class="merge-instructions">
                        <p><strong>H∆∞·ªõng d·∫´n:</strong> Ch·ªçn file Excel v√† c·∫•u h√¨nh c√°c c·ªôt c·∫ßn g·ªôp. C√≥ th·ªÉ g·ªôp nhi·ªÅu nh√≥m c·ªôt c√πng l√∫c.</p>
                    </div>
                    
                    <div class="file-selection">
                        <div class="upload-group">
                            <label>File Excel:</label>
                            <input type="file" id="merge-file" accept=".xlsx,.xls">
                            <button onclick="uploadMergeFile()">T·∫£i l√™n File</button>
                            <div id="merge-file-info" class="file-info"></div>
                        </div>
                    </div>
                    
                    <div id="merge-configuration" style="display: none;">
                        <h2>2. C·∫•u h√¨nh G·ªôp C·ªôt</h2>
                        <div id="merge-configs" class="merge-configs">
                            <!-- Dynamic merge configurations will be added here -->
                        </div>
                        
                        <div class="merge-actions">
                            <button onclick="addMergeConfig()" class="btn-secondary">‚ûï Th√™m Nh√≥m G·ªôp</button>
                            <button onclick="previewMerge()" class="btn-secondary">üëÅÔ∏è Xem Tr∆∞·ªõc</button>
                            <button onclick="performMerge()" class="btn-primary">‚úÖ Th·ª±c hi·ªán G·ªôp C·ªôt</button>
                        </div>
                        
                        <div id="merge-preview" class="merge-preview">
                            <!-- Preview results will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Split Rows Tab -->
        <div id="split-tab" class="tab-content">
            <div class="section">
                <h2>1. T·∫£i l√™n File Excel ƒë·ªÉ T√°ch D√≤ng</h2>
                <div class="feature">
                    <div class="split-instructions">
                        <p><strong>H∆∞·ªõng d·∫´n:</strong> T√°ch nhi·ªÅu c·ªôt th√†nh nhi·ªÅu d√≤ng (Unpivot). V√≠ d·ª•: 1 sinh vi√™n c√≥ nhi·ªÅu nƒÉm h·ªçc ‚Üí m·ªói nƒÉm h·ªçc th√†nh 1 d√≤ng.</p>
                        <ul>
                            <li><strong>C·ªôt ƒë·ªãnh danh:</strong> C√°c c·ªôt gi·ªØ nguy√™n (MSSV, H·ªç t√™n...)</li>
                            <li><strong>C·ªôt gi√° tr·ªã:</strong> C√°c c·ªôt s·∫Ω ƒë∆∞·ª£c t√°ch th√†nh d√≤ng (NƒÉm h·ªçc 2020, 2021, 2022...)</li>
                        </ul>
                    </div>
                    
                    <div class="file-selection">
                        <div class="upload-group">
                            <label>File Excel:</label>
                            <input type="file" id="split-file" accept=".xlsx,.xls">
                            <button onclick="uploadSplitFile()">T·∫£i l√™n File</button>
                            <div id="split-file-info" class="file-info"></div>
                        </div>
                    </div>
                    
                    <div id="split-configuration" style="display: none;">
                        <h2>2. C·∫•u h√¨nh T√°ch D√≤ng</h2>
                        
                        <div class="split-config">
                            <div class="config-group">
                                <h3>üìå C·ªôt ƒê·ªãnh Danh (Gi·ªØ nguy√™n)</h3>
                                <p><small>C√°c c·ªôt d√πng ƒë·ªÉ nh·∫≠n di·ªán t·ª´ng d√≤ng (MSSV, H·ªç t√™n...)</small></p>
                                <div class="columns-selection" id="id-columns-selection">
                                    <!-- ID columns will be populated here -->
                                </div>
                            </div>
                            
                            <div class="config-group">
                                <h3>üìä C·ªôt Gi√° Tr·ªã (T√°ch th√†nh d√≤ng)</h3>
                                <p><small>C√°c c·ªôt s·∫Ω ƒë∆∞·ª£c t√°ch th√†nh nhi·ªÅu d√≤ng (NƒÉm h·ªçc, M√¥n h·ªçc...)</small></p>
                                <div class="columns-selection" id="value-columns-selection">
                                    <!-- Value columns will be populated here -->
                                </div>
                            </div>
                            
                            <div class="naming-config">
                                <h3>üè∑Ô∏è ƒê·∫∑t T√™n C·ªôt M·ªõi</h3>
                                <div class="name-inputs">
                                    <div class="input-group">
                                        <label>T√™n c·ªôt bi·∫øn:</label>
                                        <input type="text" id="var-name" value="NƒÉm_h·ªçc" placeholder="V√≠ d·ª•: NƒÉm_h·ªçc, M√¥n_h·ªçc">
                                        <small>T√™n cho c·ªôt ch·ª©a t√™n c√°c c·ªôt c≈©</small>
                                    </div>
                                    <div class="input-group">
                                        <label>T√™n c·ªôt gi√° tr·ªã:</label>
                                        <input type="text" id="value-name" value="ƒêi·ªÉm" placeholder="V√≠ d·ª•: ƒêi·ªÉm, Gi√°_tr·ªã">
                                        <small>T√™n cho c·ªôt ch·ª©a gi√° tr·ªã</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="split-actions">
                            <button onclick="previewSplit()" class="btn-secondary">üëÅÔ∏è Xem Tr∆∞·ªõc</button>
                            <button onclick="performSplit()" class="btn-primary">‚úÖ Th·ª±c hi·ªán T√°ch D√≤ng</button>
                        </div>
                        
                        <div id="split-preview" class="split-preview">
                            <!-- Preview results will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Duplicate Finder Tab -->
        <div id="duplicate-tab" class="tab-content">
            <div class="section">
                <h2>1. T·∫£i l√™n File Excel ƒë·ªÉ T√¨m Tr√πng L·∫∑p</h2>
                <div class="feature">
                    <div class="duplicate-instructions">
                        <p><strong>H∆∞·ªõng d·∫´n:</strong> T√¨m ki·∫øm d·ªØ li·ªáu tr√πng l·∫∑p trong file Excel.</p>
                        <div class="duplicate-options">
                            <div class="option-card">
                                <h4>üîç T√¨m gi√° tr·ªã tr√πng l·∫∑p trong c·ªôt</h4>
                                <p>T√¨m c√°c gi√° tr·ªã gi·ªëng nhau trong c√°c c·ªôt c·ª• th·ªÉ (v√≠ d·ª•: MSSV, Email...)</p>
                            </div>
                            <div class="option-card">
                                <h4>üìã T√¨m d√≤ng tr√πng l·∫∑p ho√†n to√†n</h4>
                                <p>T√¨m c√°c d√≤ng gi·ªëng h·ªát nhau tr√™n t·∫•t c·∫£ c√°c c·ªôt</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="file-selection">
                        <div class="upload-group">
                            <label>File Excel:</label>
                            <input type="file" id="duplicate-file" accept=".xlsx,.xls">
                            <button onclick="uploadDuplicateFile()">T·∫£i l√™n File</button>
                            <div id="duplicate-file-info" class="file-info"></div>
                        </div>
                    </div>
                    
                    <div id="duplicate-configuration" style="display: none;">
                        <h2>2. Ch·ªçn Lo·∫°i Ki·ªÉm Tra Tr√πng L·∫∑p</h2>
                        
                        <div class="duplicate-methods">
                            <div class="method-card" id="method-values">
                                <div class="method-header">
                                    <h3>üîç T√¨m Gi√° Tr·ªã Tr√πng L·∫∑p Trong C·ªôt</h3>
                                    <button onclick="toggleMethod('values')" class="btn-primary">Ch·ªçn Ph∆∞∆°ng Ph√°p N√†y</button>
                                </div>
                                <div class="method-content" id="method-values-content" style="display: none;">
                                    <p><strong>Ch·ªçn c√°c c·ªôt c·∫ßn ki·ªÉm tra gi√° tr·ªã tr√πng l·∫∑p:</strong></p>
                                    <div class="columns-checkbox-group" id="duplicate-value-columns">
                                        <!-- Columns checkboxes will be populated here -->
                                    </div>
                                    <div class="method-actions">
                                        <button onclick="previewDuplicateValues()" class="btn-secondary">üëÅÔ∏è Xem Tr∆∞·ªõc</button>
                                        <button onclick="findDuplicateValues()" class="btn-primary">‚úÖ T√¨m Gi√° Tr·ªã Tr√πng L·∫∑p</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="method-card" id="method-rows">
                                <div class="method-header">
                                    <h3>üìã T√¨m D√≤ng Tr√πng L·∫∑p Ho√†n To√†n</h3>
                                    <button onclick="toggleMethod('rows')" class="btn-primary">Ch·ªçn Ph∆∞∆°ng Ph√°p N√†y</button>
                                </div>
                                <div class="method-content" id="method-rows-content" style="display: none;">
                                    <p><strong>Ki·ªÉm tra t·∫•t c·∫£ c√°c c·ªôt ƒë·ªÉ t√¨m d√≤ng gi·ªëng h·ªát nhau:</strong></p>
                                    <div class="method-info">
                                        <p>‚úÖ Ph∆∞∆°ng ph√°p n√†y s·∫Ω ki·ªÉm tra t·∫•t c·∫£ c√°c c·ªôt trong file</p>
                                        <p>‚úÖ T√¨m c√°c d√≤ng c√≥ d·ªØ li·ªáu gi·ªëng h·ªát nhau 100%</p>
                                        <p>‚úÖ Hi·ªÉn th·ªã c√°c nh√≥m d√≤ng tr√πng l·∫∑p</p>
                                    </div>
                                    <div class="method-actions">
                                        <button onclick="findDuplicateRows()" class="btn-primary">‚úÖ T√¨m D√≤ng Tr√πng L·∫∑p</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="duplicate-preview" class="duplicate-preview">
                            <!-- Preview results will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section (Common for all tabs) -->
        <div class="section">
            <h2>K·∫øt qu·∫£</h2>
            <div id="results" class="results">
                <p>Ch·ªçn files v√† th·ª±c hi·ªán t√≠nh nƒÉng ƒë·ªÉ xem k·∫øt qu·∫£...</p>
            </div>
        </div>
    </div>

    <!-- Join Column Selection Modal -->
    <div id="join-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeJoinModal()">&times;</span>
            <h3>Ch·ªçn C·ªôt ƒë·ªÉ Join</h3>
            <p>Ch·ªçn c√°c c·∫∑p c·ªôt ƒë·ªÉ th·ª±c hi·ªán join. C√≥ th·ªÉ ch·ªçn nhi·ªÅu c·∫∑p c·ªôt.</p>
            
            <div id="modal-columns" class="modal-columns">
                <!-- Dynamic column pairs will be added here -->
            </div>
            
            <div class="modal-buttons">
                <button onclick="addJoinColumnPair()" class="btn-secondary">‚ûï Th√™m C·ªôt</button>
                <button onclick="saveJoinColumns()" class="btn-primary">‚úÖ Th·ª±c hi·ªán Join</button>
                <button onclick="closeJoinModal()" class="btn-secondary">‚ùå H·ªßy</button>
            </div>
        </div>
    </div>

    <!-- Separator Selection Modal -->
    <div id="separator-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSeparatorModal()">&times;</span>
            <h3>Ch·ªçn D·∫•u Ph√¢n C√°ch</h3>
            <p>Ch·ªçn ho·∫∑c nh·∫≠p d·∫•u ph√¢n c√°ch ƒë·ªÉ g·ªôp c√°c c·ªôt:</p>
            
            <div class="separator-options">
                <label><input type="radio" name="separator" value=" " checked> Kho·∫£ng tr·∫Øng</label>
                <label><input type="radio" name="separator" value=","> D·∫•u ph·∫©y (,)</label>
                <label><input type="radio" name="separator" value="-"> D·∫•u g·∫°ch ngang (-)</label>
                <label><input type="radio" name="separator" value="_"> D·∫•u g·∫°ch d∆∞·ªõi (_)</label>
                <label><input type="radio" name="separator" value="/"> D·∫•u g·∫°ch ch√©o (/)</label>
                <label><input type="radio" name="separator" value="custom"> T√πy ch·ªânh:</label>
                <input type="text" id="custom-separator" placeholder="Nh·∫≠p d·∫•u ph√¢n c√°ch" style="margin-left: 20px; padding: 5px;">
            </div>
            
            <div class="modal-buttons">
                <button onclick="saveSeparator()" class="btn-primary">‚úÖ Ch·ªçn</button>
                <button onclick="closeSeparatorModal()" class="btn-secondary">‚ùå H·ªßy</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>